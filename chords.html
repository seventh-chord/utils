<html>
<head>
  <meta charset="UTF-8">
  <title>Guitar chords</title>

  <style>
    #fretboard, #chord-picker {
      display: inline-block;
      vertical-align: top;
    }
    
    #fretboard {
      user-select: none;
    }

    #fretboard table {
      margin: 20px;
      border-collapse: collapse;

      font-family: "Consolas", monospace;
      font-size: 12px;
    }
    #fretboard td {
      border: 1px solid;
    }
    #fretboard tr:first-child td {
      border-top: 3px solid;
    }
    #fretboard tr:first-child td:last-child,
    #fretboard tr:first-child td:first-child {
      border-top: none; /* The selector rules in CSS seem really wierd to me, why wouldn't it just be top to bottom? */
    }
    #fretboard td:last-child,
    #fretboard td:first-child,
    #fretboard tr:last-child td {
      border: none;
    }

    #fretboard td {
      padding: 0;
      width: 26px;
      height: 42px;
      vertical-align: top;
      text-align: left;
    }

    #fretboard span {
      display: block;
      text-align: center;
      width: 20px;
      height: 20px;
      line-height: 20px;
      border-radius: 100px; /* Apparently the play is just to set this as large as possible :P */

      position: relative;
      left: -10px;
      top: -10px;
    }

    #fretboard .finger {
      background: black;
      color: white;
    }
    #fretboard .base {
      text-decoration: underline;
    }

    #fretboard .cross {
      font-weight: bold;
      top: -20px;
    }
    #fretboard td:last-child .cross {
      top: -19px; /* No clue why this is needed... */
    }

    #fretboard .fret-number {
      font-size: 120%;
      left: -5px;
    }



    #chord-picker {
      user-select: none;
    }

    #chord-picker table {
      text-align: center;
      border-collapse: collapse;
    }

    #chord-picker td {
      border: 1px solid black;
      padding: 10px;
    }

    #chord-picker td:first-child {
      font-style: italic;
    }

    #chord-picker td.selected {
      background: #ddf;
    }
  </style>
</head>
<body>

  <h1>Guitar chords</h1>

  <div id="fretboard">
    <!-- Content is generated using javascript -->
  </div>

  <div id="chord-picker">
  </div>
  
  <script>
    const FRETS = 15;
    const SEMITONES_IN_OCTAVE = 12;

    let NOTES = [
      { name: "C", offset: 0 },
      { name: "C#", offset: 1 },
      { name: "Db", offset: 1 },
      { name: "D", offset: 2 },
      { name: "D#", offset: 3 },
      { name: "Eb", offset: 3 },
      { name: "E", offset: 4 },
      { name: "F", offset: 5 },
      { name: "F#", offset: 6 },
      { name: "Gb", offset: 6 },
      { name: "G", offset: 7 },
      { name: "G#", offset: 8 },
      { name: "Ab", offset: 8 },
      { name: "A", offset: 9 },
      { name: "A#", offset: 10 },
      { name: "Bb", offset: 10 },
      { name: "B", offset: 11 },
    ];

    // C is 0
    const STRING_OFFSETS = [
      4, // E
      9, // A
      2, // D
      7, // G
      11, // B
      4, // e
    ];


    // Intervals
    const P1  = { semitones: 0,  short: "P1",  name: "Unison" };
    const m2  = { semitones: 1,  short: "m2",  name: "Minor second" };
    const M2  = { semitones: 2,  short: "M2",  name: "Major second" };
    const m3  = { semitones: 3,  short: "m3",  name: "Minor third" };
    const M3  = { semitones: 4,  short: "M3",  name: "Major third" };
    const P4  = { semitones: 5,  short: "P4",  name: "Perfect fourth" };
    const A4  = { semitones: 6,  short: "A4",  name: "Augmented fourth" };
    const d5  = { semitones: 6,  short: "d5",  name: "Diminished fifth" };
    const P5  = { semitones: 7,  short: "P5",  name: "Perfect fifth" };
    const A5  = { semitones: 8,  short: "A5",  name: "Augmented fifth" };
    const m6  = { semitones: 8,  short: "m6",  name: "Minor sixth" };
    const M6  = { semitones: 9,  short: "M6",  name: "Major sixth" };
    const m7  = { semitones: 10, short: "m7",  name: "Minor seventh" };
    const M7  = { semitones: 11, short: "M7",  name: "Major seventh" };
    const P8  = { semitones: 12, short: "P8",  name: "Octave" };
    const m9  = { semitones: 13, short: "m9",  name: "Minor ninth" };
    const M9  = { semitones: 14, short: "M9",  name: "Major ninth" };
    const m10 = { semitones: 15, short: "m10", name: "Minor tenth" };
    const M10 = { semitones: 16, short: "M10", name: "Major tenth" };
    const P11 = { semitones: 17, short: "P11", name: "Perfect eleventh" };
    const A11 = { semitones: 18, short: "A11", name: "Augmented eleventh" };
    const d12 = { semitones: 18, short: "d12", name: "Diminished twelfth" };
    const P12 = { semitones: 19, short: "P12", name: "Perfect twelfth" };
    const m13 = { semitones: 20, short: "m13", name: "Minor thirteenth" };
    const M13 = { semitones: 21, short: "M13", name: "Major thirteenth" };


    const CHORDS = [
        { name: "Major triad", suffix: [ "" ], intervals: [ P1, M3, P5 ] },
        { name: "Minor triad", suffix: [ "m" ], intervals: [ P1, m3, P5 ] },
        { name: "Augmented", suffix: [ "aug", "+" ], intervals: [ P1, M3, A5 ] },
        { name: "Diminished", suffix: [ "dim", "Â°" ], intervals: [ P1, m3, d5 ] },
        { name: "Suspended (2)", suffix: [ "sus2" ], intervals: [ P1, M2, P5 ] },
        { name: "Suspended (4)", suffix: [ "sus4" ], intervals: [ P1, P4, P5 ] },
        // 6x seventh
        // m6? wth???
        // 9th, 11th, 13th
    ];



    function show_finger_positions(finger_positions) {
      let fretboard = "<table>";
      for (let fret = 0; fret <= FRETS; ++fret) {
        fretboard += "<tr>"; 
        
        let fret_number = "";
        if (fret == 5 || fret == 7 || fret == 9 || fret == 12 || fret == 15 || fret == 17) {
          let bullet = fret == 12? "&bull;&bull;" : "&bull;";
          fret_number = "<span class='fret-number'>" + bullet + "</span>";
        }
        fretboard += "<td>" + fret_number + "</td>";

        for (let string = 1; string <= STRING_OFFSETS.length; ++string) {
          let span = "";

          let mark = null;
          for (let i = 0; i < finger_positions.length; ++i) {
            if (finger_positions[i].string == string && finger_positions[i].fret == fret) {
              mark = finger_positions[i].label;
              break;
            }
          }
          if (mark) {
            span = "<span class='finger'>" + mark + "</span></td>";
          }

          if (fret == 0) {
            let any_mark = false;
            for (let i = 0; i < finger_positions.length; ++i) {
              if (finger_positions[i].string == string) {
                any_mark = true;
                break;
              }
            }

            if (!any_mark) {
              span = "<span class='cross'>X</span></td>";;
            }
          }

          fretboard += "<td>" + span + "</td>";
        }
        fretboard += "</tr>";
      }
      fretboard += "</table>";
      document.getElementById("fretboard").innerHTML = fretboard;
    }

    function chord_picker_onclick(note_index, chord_index) {
      let note = NOTES[note_index];
      let chord = CHORDS[chord_index];

      let table_content = document.getElementById("chord-picker").children[0].children[0].children;
      for (let i = 0; i < table_content.length; ++i) {
        let row = table_content[i].children;
        for (let j = 1; j < row.length; ++j) {
          row[j].classList.remove("selected");
        }
      }
      table_content[chord_index].children[1 + note_index].classList.add("selected");


      let finger_positions = [];

      for (let string = 1; string <= STRING_OFFSETS.length; ++string) {
        for (let fret = 0; fret <= FRETS; ++fret) {
          for (let i = 0; i < chord.intervals.length; ++i) {
            let neck_semitone = (STRING_OFFSETS[string - 1] + fret) % SEMITONES_IN_OCTAVE;
            let chord_semitone = (note.offset + chord.intervals[i].semitones) % SEMITONES_IN_OCTAVE;

            if (neck_semitone == chord_semitone) {
              finger_positions.push({ fret: fret, string: string, label: chord.intervals[i].short });
              break;
            }
          }
        }
      }

      show_finger_positions(finger_positions);
    }

    function create_chord_picker() {
      let chord_picker = "<table>";

      for (let chord_index = 0; chord_index < CHORDS.length; ++chord_index) {
        let chord = CHORDS[chord_index];

        chord_picker += "<tr>";
        chord_picker += `<td>${chord.name}</td>`;

        for (let note_index = 0; note_index < NOTES.length; ++note_index) {
          let note = NOTES[note_index];

          let names_string = "";
          for (let i = 0; i < chord.suffix.length; ++i) {
            if (i > 0) names_string += "<br>";
            names_string += note.name + chord.suffix[i];
          }

          chord_picker += `<td onclick="chord_picker_onclick(${note_index}, ${chord_index})">${names_string}</td>`;
        }

        chord_picker += "</tr>";
      }
      chord_picker += "</table>";

      document.getElementById("chord-picker").innerHTML = chord_picker;
    }

    
    create_chord_picker();
    chord_picker_onclick(Math.floor(Math.random() * NOTES.length), Math.floor(Math.random() * CHORDS.length));
  </script>
</body>
</html>
