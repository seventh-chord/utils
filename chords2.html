<html>
<head>
  <meta charset="UTF-8">
  <title>Keyboard</title>
  <style>
  
  body {
    font-family: "Consolas", monospace;
  }
  
  #pickers {
    text-align: center;
    user-select: none;
  }
  #pickers div {
    display: inline-block;
    margin-right: 30px;
  }
  #pickers h3 {
    margin-right: 5px;
  }
  
  #pickers > div > * {
    display: inline-block;
    vertical-align: middle;
  }
  #pickers table {
    border-collapse: collapse;
    cursor: pointer;
  }
  #pickers td {
    border: 1px solid;
    width: 30px;
    height: 30px;
    text-align: center;
  }
  
  #pickers td:not(.selected):hover {
    background: #eef;
  }
  #pickers .selected {
    background: #bbf;
  }
  
  
  #keyboards > div {
    margin-top: 15px;
    text-align: center;
  }
  #keyboards > div > div {
    display: inline-block;
    position: relative;
    text-align: left;
  }
  
  #keyboards .label {
    position: absolute;
    right: 100%;
    width: 120px;
    bottom: 40%;
    text-align: center;
  }

  #keyboards .black,
  #keyboards .white {
    position: absolute;
    user-select: none;
    font-size: 90%;
  }
  #keyboards .black {
    background: #444;
    color: #eee;
  }
  #keyboards .white {
    border: 1px solid black;
    color: #222;
  }  
  
  #keyboards .black span,
  #keyboards .white span {
    position: absolute;
    text-align: center;
    bottom: 0;
    width: 100%;
    line-height: 25px;
  }
  
  #keyboards .chord span {
    background: #ec5;
    color: #000;
  }
  #keyboards .root span {
    background: #d66;
    font-weight: bold;
  }
 
  </style>
</head>
<body>

<div id="pickers">
  <div id="keys">
    <h3>Key:</h3>
    <table>
      <!-- Sometimes you'll see the circle of fifths with C# and Cb, but I haven't implemented
           that, because then you start to see things like E being Fb or F being E#, which I
           didn't want to figure out how to handle in code. That being said, I assume there is
           some bespoke elegant way of writing the code so it handles all root notes properly. -->
      <!-- Actually, the code isn't even correct currently. For example, Gb, B should be called Cb -->
      
      <tr>
        <td rowspan=2 class="selected" data-semitones="0" data-accidentals="0">C</td>
        <td rowspan=2 class="selected" data-semitones="7" data-accidentals="1">G</td>
        <td rowspan=2 class="selected" data-semitones="2" data-accidentals="2">D</td>
        <td rowspan=2 class="selected" data-semitones="9" data-accidentals="3">A</td>
        <td rowspan=2 class="selected" data-semitones="4" data-accidentals="4">E</td>
        <td rowspan=2 class="selected" data-semitones="11" data-accidentals="5">B</td>
        <td rowspan=1 class="selected" data-semitones="6" data-accidentals="-6">G&flat;</td>
        <td rowspan=2 class="selected" data-semitones="1" data-accidentals="-5">D&flat;</td>
        <td rowspan=2 class="selected" data-semitones="8" data-accidentals="-4">A&flat;</td>
        <td rowspan=2 class="selected" data-semitones="3" data-accidentals="-3">E&flat;</td>
        <td rowspan=2 class="selected" data-semitones="10" data-accidentals="-2">B&flat;</td>
        <td rowspan=2 class="selected" data-semitones="5" data-accidentals="-1">F</td>
      </tr>
      <tr>
        <td rowspan=1 class="selected" data-semitones="6" data-accidentals="6">F&sharp;</td>
      </tr>
      <tr>
        <td rowspan=2 class="selected" data-semitones="9" data-accidentals="0">a</td>
        <td rowspan=2 class="selected" data-semitones="4" data-accidentals="1">e</td>
        <td rowspan=2 class="selected" data-semitones="11" data-accidentals="2">b</td>
        <td rowspan=2 class="selected" data-semitones="6" data-accidentals="3">f&sharp;</td>
        <td rowspan=2 class="selected" data-semitones="1" data-accidentals="4">c&sharp;</td>
        <td rowspan=2 class="selected" data-semitones="8" data-accidentals="5">g&sharp;</td>
        <td rowspan=1 class="selected" data-semitones="3" data-accidentals="-6">e&flat;</td>
        <td rowspan=2 class="selected" data-semitones="10" data-accidentals="-5">b&flat;</td>
        <td rowspan=2 class="selected" data-semitones="5" data-accidentals="-4">f</td>
        <td rowspan=2 class="selected" data-semitones="0" data-accidentals="-3">c</td>
        <td rowspan=2 class="selected" data-semitones="7" data-accidentals="-2">g</td>
        <td rowspan=2 class="selected" data-semitones="2" data-accidentals="-1">d</td>
      </tr>
      <tr>
        <td rowspan=1 class="selected" data-semitones="3" data-accidentals="6">d&sharp;</td>
      </tr>
    </table>
  </div>
</div>

<div id="keyboards">
</div>


<script>

  let chosen_root_semitone = 0;
  let chosen_key_accidentals = 0;
  let chosen_scale = "";
  
  
  let KEYBOARD_KEYS = [
    // White keys
    { offset: 0, semitones: 0,  names: "C", black: false },
    { offset: 1, semitones: 2,  names: "D", black: false },
    { offset: 2, semitones: 4,  names: "E", black: false },
    { offset: 3, semitones: 5,  names: "F", black: false },
    { offset: 4, semitones: 7,  names: "G", black: false },
    { offset: 5, semitones: 9,  names: "A", black: false },
    { offset: 6, semitones: 11, names: "B", black: false },

    // Black keys
    { offset: 0, semitones: 1,  names: "C&sharp; D&flat;", black: true },
    { offset: 1, semitones: 3,  names: "D&sharp; E&flat;", black: true },
    { offset: 3, semitones: 6,  names: "F&sharp; G&flat;", black: true },
    { offset: 4, semitones: 8,  names: "G&sharp; A&flat;", black: true },
    { offset: 5, semitones: 10, names: "A&sharp; B&flat;", black: true },
  ];

  let OCTAVES = 2;
  let WHITE_KEYS_IN_OCTAVE = 7;
  
  let INTERVALS = {
    "P1": 0,
    "M2": 2,
    "m3": 3,
    "M3": 4,
    "P4": 5,
    "d5": 6,
    "P5": 7,
    "m6": 8,
    "M6": 9,
    "m7": 10,
    "M7": 11,
  };
  
  let NOTES_MAJOR = [ 0, 2, 4, 5, 7, 9, 11 ];
  let CHORDS_MAJOR = [
    { suffix: " (I)",             root: 0, intervals: "P1 M3 P5" },
    { suffix: "m (ii)",           root: 2, intervals: "P1 m3 P5" },
    { suffix: "m (iii)",          root: 4, intervals: "P1 m3 P5" },
    { suffix: " (IV)",            root: 5, intervals: "P1 M3 P5" },
    { suffix: " (V)",             root: 7, intervals: "P1 M3 P5" },
    { suffix: "m (vi)",           root: 9, intervals: "P1 m3 P5" },
    { suffix: "&deg; (vii&deg;)", root: 11, intervals: "P1 m3 d5" },
  ];

  let NOTES_MINOR = [ 0, 2, 3, 5, 7, 8, 10 ];
  let CHORDS_MINOR = [
    { suffix: "m (i)",            root: 0, intervals: "P1 m3 P5" },
    { suffix: "&deg; (ii&deg;)",  root: 2, intervals: "P1 m3 d5" },
    { suffix: " (bIII)",          root: 3, intervals: "P1 M3 P5" },
    { suffix: "m (iv)",           root: 5, intervals: "P1 m3 P5" },
    { suffix: "m (v)",            root: 7, intervals: "P1 m3 P5" },
    { suffix: " (bVI)",           root: 8, intervals: "P1 M3 P5" },
    { suffix: " (bVII)",          root: 10, intervals: "P1 M3 P5" },
  ];
  
  
  
  function pick_name(semitone, key_accidentals) {
    semitone = semitone%12;
    for (let key of KEYBOARD_KEYS) {
      if (key.semitones == semitone) {
        let names = key.names.split(" ");
        if (chosen_key_accidentals > 0) for (let n of names) if (n.includes("sharp")) return n;
        if (chosen_key_accidentals < 0) for (let n of names) if (n.includes("flat")) return n;
        return names[0];
      }
    }
    return "?";
  }
  

  let white_width = 40;
  let white_height = 90;
  let black_width = 29;
  let black_height = 50;


  function update() {
    let html = "";
    
    let chords =
      chosen_scale == "major"? CHORDS_MAJOR :
      chosen_scale == "minor"? CHORDS_MINOR :
      [];
    
    let notes =
      chosen_scale == "major"? NOTES_MAJOR :
      chosen_scale == "minor"? NOTES_MINOR :
      [];
    
    for (let chord of chords) {
      let semitone_map = [];
      for (let i = 0; i < 12; ++i) semitone_map[i] = {};
      
      for (let note_semitone_offset of notes) {
        semitone_map[(chosen_root_semitone + note_semitone_offset)%12].show = true;
      }
      for (let interval of chord.intervals.split(" ")) {
        let semitone_offset = INTERVALS[interval];
        semitone_map[(chosen_root_semitone + chord.root + semitone_offset)%12].chord = true;
      }

      html += "<div>";
      html += "<div style='width: " + (white_width*WHITE_KEYS_IN_OCTAVE*OCTAVES) + "px; height: " + white_height + "px;'>";
      html += "<span class='label'>" + pick_name(chosen_root_semitone + chord.root, chosen_key_accidentals) + chord.suffix + "</span>";

      for (let octave = 0; octave < OCTAVES; ++octave) {
        for (let key of KEYBOARD_KEYS) {
          
          let mark_class = "";
          if (key.semitones == (chosen_root_semitone + chord.root)%12) mark_class += " root";
          if (semitone_map[key.semitones].chord) mark_class += " chord";

          if (key.black) {
            let x = (octave*WHITE_KEYS_IN_OCTAVE + key.offset + 1)*white_width - Math.ceil(black_width / 2);
            html += "<span class='black " + mark_class + "' style='left: " + x + "px; width: " + black_width + "px; height: " + black_height + "px'>";
          } else {
            let x = (octave*WHITE_KEYS_IN_OCTAVE + key.offset)*white_width;
            html += "<span class='white " + mark_class + "' style='left: " + x + "px; width: " + (white_width - 1) + "px; height: " + white_height + "px'>";
          }
          
          if (semitone_map[key.semitones].show) {
            html += "<span>" + pick_name(key.semitones, chosen_key_accidentals) + "</span>";
          }
          html += "</span>";
        }
      }
      html += "</div></div>";
    }
    
    document.getElementById("keyboards").innerHTML = html;
  }
  
  
  let key_tds = Array.from(document.getElementById("keys").getElementsByTagName("td"));
  function key_onclick() {
    for (let other_key of key_tds) other_key.classList.remove("selected");
    this.classList.add("selected");
    
    chosen_root_semitone = parseInt(this.dataset.semitones);
    chosen_key_accidentals = this.dataset.accidentals;
    chosen_scale = this.innerText[0] == this.innerText[0].toUpperCase()? "major" : "minor";
    
    update();
  }
  for (let key of key_tds) key.onclick = key_onclick;
  
  key_tds[0].onclick();

</script>

</body>
</html>
